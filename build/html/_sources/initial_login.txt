*************
Initial Login
*************

From an end-user's point-of-view, when they select the travel option on the
B2B partner's mobile-app they should be taken to a screen which shows
potential inventory they can purchase (inventory can be a flight booking,
hotel reservation, bus ticket ... etc).

In the background, the B2B Partner will pass user details to Goibibo. We will
then register the user on our platform and show them different travel
inventory. This will be initiated from the mobile app by opening a WebView and
calling a login API. After the user is successfully logged-in, the API will
return HTML which gets rendered within the WebView.

Goibibo offers multiple login APIs for partners to use. Details about them are
as follows,

.. note::

   Please use ``pp.goibibobusiness.com`` for development/testing purposes and
   ``www.goibibobusiness.com`` in the production environment.


Send ALL user details to Goibibo
================================

We recommend this approach as it allows for the end-user to be logged into our
system with minimal delay. You can visualize the flow with the following
diagram,

.. seqdiag::

    seqdiag {
        default_fontsize = 14;
        Mobile-app; Goibibo;

        Mobile-app  ->  Goibibo [label = "API call"];
                        Goibibo  -> Goibibo [label = "login user with new session"];
        Mobile-app <--  Goibibo [label = "return logged-in website"];
    }

Here are the API details,

.. note::

   Please replace ``example_bank`` with your organization-code

.. http:get:: http://pp.goibibobusiness.com/b2b_partner/example_bank/start_login/
    :noindex:

    :query user_id: A string to uniquely identify a user
    :query timestamp: Time request is made, format: YYYY-MM-DD HH:MM
    :query token: The Token number to use when calling Partner APIs
    :query checksum: CRC32 value to check integrity of request
    :query version: A string '1.0' (without quotes)
    :query f_name: First name of end-user
    :query m_name: Middle name of end-user
    :query l_name: Last name of end-user
    :query mobile: Confirmed mobile number of end-user
    :query email: Confirmed email-id of end-user
    :query vertical: (optional) default value is 'flight'

    You can pass ``flight`` , ``hotels`` or ``bus`` as vertical to directly
    login to the corresponding page.

    If this end-point is issued a GET request without any parameters on a
    production system, an error page will be returned. On the pre-production
    environment, a simple HTML form will be returned which can be used by
    a developer with Chrome browser for debugging/testing.

    The checksum can be generated by passing a **single string** to a CRC32
    function. This input string can be created by appending the following
    data,

    'example_bank' + user_id + timestamp + token + LOGIN_KEY

.. note::

   Please contact us for LOGIN_KEY


Request Goibibo to fetch user details
=====================================

We do NOT recommend this approach, as it can significantly increase the time
taken for the end-user to get logged in. Here is a visualization of the
control flow,

.. seqdiag::

    seqdiag {
        default_fontsize = 14;
        Mobile-app; Goibibo; B2B-Partner;

        Mobile-app  ->  Goibibo [label = "API call"];
        Mobile-app <--  Goibibo [label = "return temporary landing page"];
        Mobile-app  ->  Goibibo [label = "landing page initiates external login call"];
                        Goibibo  -> B2B-Partner [label = "request user details"];
                        Goibibo <-- B2B-Partner [label = "return data"];
                        Goibibo  -> Goibibo [label = "login user with new session"];
        Mobile-app <--  Goibibo [label = "return logged-in website"];
    }

When a valid request comes in, we immediately show a temporary landing page to
the end-user. This gives the end-user a visual assurance that the site is
active (and hasn't crashed). After the landing page loads, our server will
request for user details from the B2B-Partner API. Once the details are
verified, we return a logged-in session back to WebView on end-user's mobile
device.

In our experience without the temporary landing page, some users would be
stuck seeing a blank page while we verified them. Depending on network
conditions, the verification would take too long and many of them would quit
the application without making any travel purchases.

To initiate the above flow here is the API which has to be called,

.. note::

   Please replace ``example_bank`` with your organization-code

.. http:get:: http://pp.goibibobusiness.com/b2b_partner/example_bank/start/
    :noindex:

    :query token: The Token number to use when calling Partner APIs
    :query version: A string '1.0' (without quotes)
    :query vertical: (optional) default value is 'flight'

    You can pass ``flight`` , ``hotels`` or ``bus`` as vertical to directly
    login to the corresponding page.

    B2B-Partner is expected to provide us user-details API.